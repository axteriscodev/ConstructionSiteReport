


<DynamicComponent @ref="@comp" Type="componentType" Parameters="parameters"/>

@code {

    [Parameter]
    public EventCallback OnOperationComplete { get; set; }
    private DynamicComponent? comp;
    Dictionary<string, object>? parameters;
    private Type componentType = typeof(FormEmail);
    int step = 0;
    private string email = "";
    private string token = "";

    protected override async Task OnInitializedAsync()
    {
        ChangeStep();
        await base.OnInitializedAsync();
    }

    private void ChangeStep(string value = "")
    {
        step += 1;

        switch(step)
        {
            case 1:
                componentType = typeof(FormEmail);
                parameters = new() 
                { 
                   { "OnForward", EventCallback.Factory.Create<string>(this, ChangeStep) }
                };
                break;
            case 2:
                email = value;
                componentType = typeof(FormResetToken);
                parameters = new()
                {
                   { "OnForward", EventCallback.Factory.Create<string>(this, ChangeStep) },
                   { "Email", email}
                };
                break;
            case 3:
                token = value;
                componentType = typeof(FormChangePasswordToken);
                parameters = new()
                {
                   { "OnForward", EventCallback.Factory.Create(this, Close) },
                   { "Email", email},
                   { "Token", token}
                };
                break;
            default:
                break;
        }
        StateHasChanged();
    }

    private async Task Close()
    {
        await OnOperationComplete.InvokeAsync();
    }

}

