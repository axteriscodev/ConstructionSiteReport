@using Shared.Documents
@inject DocumentsRepository DocumentsRepository

@if (onLoading)
{
    <Loading />
}
else
{
    <div class="card shadow DocumentCard">
        <ReportConstructorSiteDataSection Document="@document" />
        <CompaniesPresentSection Companies="@document.Companies" />
        <QuestionsSection Categories="document.Categories" Companies="document.Companies" OnStateChangeNotification="@QuestionNoteUpdated" />
	    <FormQuestionAdditionalNotesList Document="@document" />
        <CompaniesSignsSection Document="@document" />
    </div>
}

@code {
    [Parameter]
    public int DocumentId { get; set; }
    private DocumentModel document = new();
    private bool onLoading = false;

    protected override async Task OnInitializedAsync()
    {
        onLoading = true;
        await base.OnInitializedAsync();
        await LoadData();
        onLoading = false;
    }
    private async Task LoadData()
    {
        document = await DocumentsRepository.GetDocumentById(DocumentId);
    }

    private void QuestionNoteUpdated(){
        StateHasChanged();
    }
}
