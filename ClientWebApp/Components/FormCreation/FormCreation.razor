@using ClientWebApp.Managers
@using ClientWebApp.Repositories
@using Shared;

@inject CategoriesRepository CategoriesRepository
@inject DocumentsRepository DocumentsRepository
@inject DialogService DialogService

@if (initialLoading)
{
    <Loading />
}
else
{
    <h2>@Param</h2>

    <div class="mt-4 m-5 shadow rounded px-5 py-2">
        <RadzenFormField Text="Titolo <span style='color:red'> (obbligatorio)</span>" Variant="@variant" class="my-4" Style="width:100%">
            <ChildContent>
                <RadzenTextBox Name="Titolo" @bind-Value="@title" />
            </ChildContent>
            <Helper>
                <RadzenRequiredValidator Component="Titolo" Popup=false Text="Il campo Titolo è obbligatorio" />
            </Helper>
        </RadzenFormField>
        <RadzenFieldset Text="Seleziona le domande" Style="font-weight:400;">
            @foreach (var g in groups)
            {
                <div class="card shadow m-2 p-2 pt-3">
                    <RadzenRow>
                        <RadzenCheckBox TValue="bool?" TriState="true" @bind-Value="g.State" Style="margin-top: 0.2rem;" Change="@(args=> ChangeCheckBoxCategory(args, g))" />
                        <RadzenText TextStyle="TextStyle.DisplayH6"><strong>@CategoryText(g)</strong></RadzenText>
                    </RadzenRow>
                </div>
                <SortableList Id="sortable" GroupNumber="@g.Id" Items="@g.Questions" OnGroupUpdate="@OrderList" Context="item">
                    <SortableItemTemplate>
                        <div class="card shadow m-2 p-2 pt-3" style="margin-left:3rem !important;">
                            <RadzenRow Style="flex-wrap:nowrap !important">
                                <RadzenCheckBox class="ps-3 fw-normal" TValue="bool" Value="@ValoreCheckBoxQuestion(item.Id, g)" TriState="false"
                                                Change="@(args => ChangeCheckBoxQuestion(args, item.Id, g))" Style="margin-top: 0.2rem;" />
                                <RadzenText>@QuestionText(g, item.Text, item.Order)</RadzenText>
                            </RadzenRow>
                        </div>
                    </SortableItemTemplate>
                </SortableList>
            }
        </RadzenFieldset>
        <RadzenButton Icon="add" Text="Crea modulo" ButtonStyle="ButtonStyle.Primary" class="ButtonAdd"
                      Style="margin-bottom:2rem;margin-top:1rem;" Click="@(()=>CreateForm())" />
    </div>

}

@* <RadzenCheckBoxList @bind-Value=@g.SelectedQuestionIds class="fw-bold" AllowSelectAll="true" SelectAllText=@g.Text TValue="int" Orientation="Orientation.Vertical">
                   <Items>
                        @foreach (var q in g.Questions)
                        {
                            <RadzenCheckBoxListItem class="ps-3 fw-normal" Value="@q.Id" Text="@q.Text" />
                        }
                    </Items>
        </RadzenCheckBoxList>*@

